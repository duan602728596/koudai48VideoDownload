<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="../style/index.css" rel="stylesheet">
    <link href="../style/download.css" rel="stylesheet">
</head>
<body>
<!-- 正常显示的列表 -->
<div class="index-app" id="app">
    <!-- 顶部功能菜单 -->
    <header class="bg-warning index-tools clearfix">
        <!-- 关键字搜索 -->
        <div class="pull-left form-inline index-searchGroup">
            <label for="searchName">搜索已加载列表：</label>
            <input class="form-control index-searchInput" type="text" id="searchName" placeholder="多个关键字用空格分割"
                   v-bind:value="inputText" v-on:input="keywordsChange($event)" v-on:keydown="searchEnter($event)">
            <button class="btn btn-default" type="button" v-on:click="search($event)">
                <span class="glyphicon glyphicon-search index-icon"></span>搜索
            </button>
            <button class="btn btn-default" type="button" v-on:click="reset($event)">
                <span class="glyphicon glyphicon-remove index-icon"></span>重置
            </button>
        </div>
        <!-- 加载和刷新 -->
        <div class="pull-right">
            <button class="btn btn-primary" type="button" v-on:click="loadingReviewList($event)">
                <span class="glyphicon glyphicon-cloud-download  index-icon"></span>加载列表
            </button>
            <button class="btn btn-default" type="button" v-on:click="reloadReviewList($event)">
                <span class="glyphicon glyphicon-refresh index-icon"></span>刷新列表
            </button>
            <button class="btn btn-default" type="button" v-on:click="downloadOpen($event)">
                <span class="glyphicon glyphicon-th-list index-icon"></span>下载列表
            </button>
        </div>
    </header>
    <!-- 表格显示数据 -->
    <div class="index-dataBox">
        <table class="table table-bordered table-hover table-condensed index-table">
            <thead>
                <tr class="info">
                    <th class="index-table-td0">序号</th>
                    <th class="index-table-td1">直播间</th>
                    <th class="index-table-td2">直播标题</th>
                    <th class="index-table-td3">开始时间</th>
                    <th class="index-table-td4">操作</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item, index) in reviewList" :key="index" v-if="guoLv(item.title) === true">
                    <td>{{ index }}</td>
                    <td>{{ item.title }}</td>
                    <td>
                        <a target="_blank" v-bind:href="item.streamPath" v-bind:title="item.streamPath">{{ item.subTitle }}</a>
                    </td>
                    <td>{{ date(item.startTime) }}</td>
                    <td>
                        <button class="btn btn-default btn-sm" type="button" v-on:click="goToPlay($event, item)">
                            <span class="glyphicon glyphicon-eye-open index-icon"></span>查看
                        </button>
                        <button class="btn btn-default btn-sm" v-on:click="download(item)">
                            <span class="glyphicon glyphicon-save index-icon"></span>下载
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <!-- 视频展示 -->
    <div class="index-layout" v-if="videoData !== null">
        <div class="index-videoBox">
            <video height="100%" controls>
                <source type="video/mp4" v-bind:src="videoData.streamPath">
                <source type="video/ogg" v-bind:src="videoData.streamPath">
                <source type="video/webm" v-bind:src="videoData.streamPath">
            </video>
        </div>
        <div class="index-videoClose">
            <div class="clearfix">
                <button class="pull-right btn btn-danger" type="button" v-on:click="videoClose($event)">
                    <span class="glyphicon glyphicon-off index-icon"></span>关闭
                </button>
            </div>
            <div class="index-videoData">
                <h4>视频信息</h4>
                <p><b>liveId：</b>{{ videoData.liveId }}</p>
                <p><b>title：</b>{{ videoData.title }}</p>
                <p><b>subTitle：</b>{{ videoData.subTitle }}</p>
                <p><b>streamPath：</b>{{ videoData.streamPath }}</p>
                <p><b>startTime：</b>{{ videoData.startTime }}</p>
            </div>
        </div>
    </div>
    <!-- loading -->
    <div class="index-layout" v-if="loading === true">
        <div class="text-center index-loadingText">
            <svg class="index-loadingIcon" viewBox="0 0 32 32">
                <path d="M32 16c-0.040-2.089-0.493-4.172-1.331-6.077-0.834-1.906-2.046-3.633-3.533-5.060-1.486-1.428-3.248-2.557-5.156-3.302-1.906-0.748-3.956-1.105-5.981-1.061-2.025 0.040-4.042 0.48-5.885 1.292-1.845 0.809-3.517 1.983-4.898 3.424s-2.474 3.147-3.193 4.994c-0.722 1.846-1.067 3.829-1.023 5.79 0.040 1.961 0.468 3.911 1.254 5.694 0.784 1.784 1.921 3.401 3.316 4.736 1.394 1.336 3.046 2.391 4.832 3.085 1.785 0.697 3.701 1.028 5.598 0.985 1.897-0.040 3.78-0.455 5.502-1.216 1.723-0.759 3.285-1.859 4.574-3.208 1.29-1.348 2.308-2.945 2.977-4.67 0.407-1.046 0.684-2.137 0.829-3.244 0.039 0.002 0.078 0.004 0.118 0.004 1.105 0 2-0.895 2-2 0-0.056-0.003-0.112-0.007-0.167h0.007zM28.822 21.311c-0.733 1.663-1.796 3.169-3.099 4.412s-2.844 2.225-4.508 2.868c-1.663 0.646-3.447 0.952-5.215 0.909-1.769-0.041-3.519-0.429-5.119-1.14-1.602-0.708-3.053-1.734-4.25-2.991s-2.141-2.743-2.76-4.346c-0.621-1.603-0.913-3.319-0.871-5.024 0.041-1.705 0.417-3.388 1.102-4.928 0.683-1.541 1.672-2.937 2.883-4.088s2.642-2.058 4.184-2.652c1.542-0.596 3.192-0.875 4.832-0.833 1.641 0.041 3.257 0.404 4.736 1.064 1.48 0.658 2.82 1.609 3.926 2.774s1.975 2.54 2.543 4.021c0.57 1.481 0.837 3.064 0.794 4.641h0.007c-0.005 0.055-0.007 0.11-0.007 0.167 0 1.032 0.781 1.88 1.784 1.988-0.195 1.088-0.517 2.151-0.962 3.156z"></path>
            </svg>
            <span class="index-tishi">正在获取数据，请稍后...</span>
        </div>
    </div>
    <!-- 下载列表 -->
    <div class="download" v-if="downloadDisplay === true">
        <header class="bg-warning download-header clearfix">
            <h4 class="pull-left">下载列表：</h4>
            <button class="pull-right btn btn-danger" type="button" v-on:click="downloadClose($event)">
                <span class="glyphicon glyphicon-off index-icon"></span>关闭
            </button>
        </header>
        <div class="download-body">
            <table class="table">
                <thead>
                    <tr class="info">
                        <th class="download-table-td0">直播标题</th>
                        <th class="download-table-td1">文件名</th>
                        <th class="download-table-td2">视频地址</th>
                        <th class="download-table-td3">操作</th>
                    </tr>
                </thead>
                <tbody>
                    <template v-for="(item, index) in downloadList" :key="index">
                        <tr>
                            <td>{{ item.infor.subTitle }}</td>
                            <td>{{ item.filename }}</td>
                            <td>{{ item.infor.streamPath }}</td>
                            <td>
                                <button class="btn btn-danger btn-sm" v-if="item.state === 1" v-on:click="cancel(index, item)">
                                    <span class="glyphicon glyphicon-remove-circle index-icon"></span>取消下载
                                </button>
                                <b v-if="item.state === 2">下载完成</b>
                                <b v-if="item.state === 3">取消下载</b>
                            </td>
                        </tr>
                        <tr class="active">
                            <td colspan="4">
                                <div class="download-progressBox clearfix">
                                    <div class="pull-left progress download-progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" v-bind:style="style(item)" v-bind:aria-valuenow="progressText(item)" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <b class="pull-right download-progressNumber">{{ progressText(item) }}%</b>
                                </div>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- 脚本 -->
<script>
    /* 全局变量 */
    window._shareData = {
        'downloadList': []  // 下载列表
    };
</script>
<script src="../script/common/nodeRequire.js"></script>
<script src="https://cdn.bootcss.com/systemjs/0.20.12/system.js"></script>
<script src="../script/index.js"></script>
<script src="../script/download.js"></script>
</body>
</html>